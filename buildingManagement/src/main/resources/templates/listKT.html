<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Danh sách khoản thu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .action-buttons .btn {
          margin-right: 5px;
        }
        footer {
            background-color: #1e3a8a;
            color: white;
            text-align: center;
            padding: 15px 0;
            position: fixed;
            bottom: 0;
            left: 250px;
            width: calc(100% - 250px);
        }
         header {
      background-color: #1e3a8a;
      color: white;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
    }
        .auth-buttons button {
      background-color: #3b82f6;
      color: white;
      border: none;
      padding: 8px 15px;
      margin-left: 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    aside {
      margin-top: 60px;
      width: 250px;
      background-color: #1e40af;
      color: white;
      padding: 20px;
      height: calc(100vh - 60px);
      position: fixed;
    }

    .sidebar-button {
      display: block;
      width: 100%;
      padding: 12px;
      margin-bottom: 10px;
      background-color: #3b82f6;
      border: none;
      color: white;
      text-align: left;
      border-radius: 6px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .sidebar-button:hover {
      background-color: #2563eb;
    }
        main {
      margin-left: 250px;
      padding: 80px 30px 30px;
      flex: 1;
    }
    </style>
    <header>
        <h1>Bluemoon</h1>
        <div class="auth-buttons">
            <p>Xin chào, <span th:text="${username}"></span>!</p>
            <a th:href="@{/logout}">Đăng xuất</a>


        </div>
    </header>

</head>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<br>
<body class="bg-light">
<aside>
    <br>
    <h5>Điều hướng</h5>

    <!-- Các nút dành cho KẾ TOÁN -->
    <div sec:authorize="hasRole('ROLE_KETOAN')">
        <a th:href="@{/Bluemoon/dashboard}" class="sidebar-button" onclick="selectMenu('khoanThu')">Trang chủ</a>
        <a th:href="@{/khoanthu/list}" class="sidebar-button" onclick="selectMenu('khoanThu')">Quản lý khoản thu</a>

        <a th:href="@{/noptien/list}" class="sidebar-button" onclick="selectMenu('lichsu')">Lịch sử thu phí</a>
        <a th:href="@{/default/thongke}" class="sidebar-button" onclick="selectMenu('thongke')">Thống kê</a>
        <a th:href="@{/default/user/profile}" class="sidebar-button">Hồ sơ người dùng</a>


    </div>
    <!-- Các nút chỉ dành cho ADMIN -->
    <div sec:authorize="hasRole('ROLE_ADMIN')">
        <a th:href="@{/Bluemoon/dashboard}" class="sidebar-button" onclick="selectMenu('khoanThu')">Trang chủ</a>
        <a th:href="@{/default/ho-nhankhau}" class="sidebar-button" onclick="selectMenu('hoKhau')">Quản lý hộ-nhân khẩu</a>


        <!--<a th:href="@{/nhankhau/list}" class="sidebar-button" onclick="selectMenu('nhanKhau')">Đăng kí tạm trú tạm vắng</a>-->
        <a th:href="@{/default/users}" class="sidebar-button" onclick="selectMenu('user')">Quản lý người dùng</a>
        <a th:href="@{/default/thongke}" class="sidebar-button" onclick="selectMenu('bienDong')">Thống kê</a>
        <a th:href="@{/default/user/profile}" class="sidebar-button">Hồ sơ người dùng</a>
    </div>
    <div sec:authorize="hasRole('ROLE_USER')">
        <a th:href="@{/Bluemoon/dashboard}" class="sidebar-button" onclick="selectMenu('khoanThu')">Trang chủ</a>
        <a th:href="@{/khoanthu/list}" class="sidebar-button" onclick="selectMenu('hoKhau')">Danh sách khoản thu</a>
        <a th:href="@{/noptien/list}" class="sidebar-button" onclick="selectMenu('nhanKhau')">Lịch sử nộp tiền</a>
        <a th:href="@{/default/thongke}" class="sidebar-button" onclick="selectMenu('user')">Thống kê</a>
        <a th:href="@{/default/user/profile}" class="sidebar-button">Hồ sơ người dùng</a>

    </div>
</aside>

<br>
<main>
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Danh sách khoản thu</h2>
        <!-- Nút mở modal -->
        <button sec:authorize="hasRole('ROLE_KETOAN')" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal">+ Thêm khoản thu</button>

        <!-- Modal thêm khoản thu -->
        <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">

                    <form th:action="@{/khoanthu/save}" method="post" th:object="${newKhoanThu}">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title" id="addModalLabel">Thêm khoản thu mới</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>

                        <div class="modal-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Tên khoản thu</label>
                                    <input type="text" th:field="*{tenkhoanthu}" class="form-control" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Bắt buộc</label>
                                    <select th:field="*{batbuoc}" class="form-select">
                                        <option th:value="true">Có</option>
                                        <option th:value="false">Không</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Ngày tạo</label>
                                    <input type="date" th:field="*{ngaytao}" class="form-control" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Thời hạn</label>
                                    <input type="date" th:field="*{thoihan}" class="form-control" required>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Ghi chú</label>
                                    <textarea th:field="*{ghichu}" class="form-control"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Lưu</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        </div>
                    </form>

                </div>
            </div>
        </div>

    </div>

    <table class="table table-bordered table-striped align-middle text-center">
        <thead class="table-primary">
        <tr>
            <th>ID</th>
            <th>Ngày tạo</th>
            <th>Thời hạn</th>
            <th>Tên khoản thu</th>
            <th>Bắt buộc</th>
            <th>Ghi chú</th>
            <th>Hành động</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="kt : ${list}">
            <td th:text="${kt.id}">1</td>
            <td th:text="${#dates.format(kt.ngaytao, 'dd/MM/yyyy')}">01/01/2024</td>
            <td th:text="${#dates.format(kt.thoihan, 'dd/MM/yyyy')}">15/01/2024</td>
            <td th:text="${kt.tenkhoanthu}">Phí quản lý</td>
            <td>
                <span th:text="${kt.batbuoc} ? 'Có' : 'Không'"></span>
            </td>
            <td th:text="${kt.ghichu}">Thu hàng tháng</td>
            <td class="action-buttons">
                <!--<a th:href="@{/khoanthu/edit/{id}(id=${kt.id})}" class="btn btn-warning btn-sm">Sửa</a>-->
                <form th:action="@{/khoanthu/delete/{id}(id=${kt.id})}" method="post" style="display:inline;"
                      onsubmit="return confirm('Bạn có chắc muốn xóa khoản thu này?');">
                    <input type="hidden" name="_method" value="delete" />
                    <button sec:authorize="hasRole('ROLE_KETOAN')" type="submit" class="btn btn-danger btn-sm">Xoá</button>
                </form>

                <!-- Nút mở modal -->
                <button sec:authorize="hasRole('ROLE_USER')" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#fakeTransactionModal">Nộp</button>

                <!-- Modal -->
                <div class="modal fade" id="fakeTransactionModal" tabindex="-1" aria-labelledby="fakeTransactionModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">

                            <!-- Form KHÔNG gửi thật -->
                            <form onsubmit="return handleFakeSubmit(event)">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title" id="fakeTransactionModalLabel">Giao dịch chuyển khoản ảo</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>

                                <div class="modal-body">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Họ tên người gửi</label>
                                            <input type="text" class="form-control" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Số tài khoản</label>
                                            <input type="text" class="form-control" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Mã giao dịch</label>
                                            <input type="text" class="form-control" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Ngày giao dịch</label>
                                            <input type="date" class="form-control" required>
                                        </div>
                                    </div>

                                    <hr class="my-4">
                                    <div class="text-center">
                                        <p>Mã QR </p>
                                        <img src="/qr.png" alt="Mã QR" style="max-width: 200px;">

                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary">Lưu</button>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>

                <!-- JavaScript xử lý form -->



            </td>
        </tr>
        </tbody>
    </table>
</div>
</main>
<script>
    function selectMenu(menu) {
        // Ẩn các phần khác (nếu có)
        document.getElementById('thongKeSection').style.display = 'none';

        if(menu === 'thongKe') {
            document.getElementById('thongKeSection').style.display = 'block';
        }
        // Bạn có thể ẩn/hiện các phần khác tương tự nếu có
    }

                    function handleFakeSubmit(event) {
                      event.preventDefault(); // Ngăn gửi form
                      const modal = bootstrap.Modal.getInstance(document.getElementById('fakeTransactionModal'));
                      modal.hide(); // Đóng modal
                      // Bạn có thể thêm alert ở đây nếu muốn demo thành công
                      alert("Dữ liệu giao dịch đã được ghi nhận ");
                      return false;
                    }

</script>


</body>
<br>
<footer>
    <p>&copy; 2025 Bluemoon Apartment Management. Thiết kế bởi Nhóm 20 KTPM-HUST.</p>
</footer>
</html>
