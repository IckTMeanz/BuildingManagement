<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Danh sách hộ khẩu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .action-buttons .btn {
            margin-right: 5px;
        }
        footer {
            background-color: #1e3a8a;
            color: white;
            text-align: center;
            padding: 15px 0;
        }
        header {
            background-color: #1e3a8a;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }
        .auth-buttons button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 8px 15px;
            margin-left: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        aside {
            margin-top: 60px;
            width: 250px;
            background-color: #1e40af;
            color: white;
            padding: 20px;
            height: calc(100vh - 60px);
            position: fixed;
        }
        .sidebar-button {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background-color: #3b82f6;
            border: none;
            color: white;
            text-align: left;
            border-radius: 6px;
            font-size: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .sidebar-button:hover {
            background-color: #2563eb;
        }
        main {
            margin-left: 250px;
            padding: 80px 30px 30px;
            flex: 1;
        }
    </style>
</head>
<body class="bg-light">
<header>
    <h1>Bluemoon</h1>
</header>

<aside>
    <br>
    <h5>Điều hướng</h5>

    <!-- Các nút dành cho cả ADMIN và KẾ TOÁN -->
    <div sec:authorize="hasRole('ROLE_KETOAN')">
        <a th:href="@{/khoanthu/list}" class="sidebar-button" onclick="selectMenu('khoanThu')">Quản lý khoản thu</a>
        <button class="sidebar-button" onclick="selectMenu('dotThu')">Tạo & quản lý đợt thu</button>
        <button class="sidebar-button" onclick="selectMenu('lapDotThu')">Lập đợt thu theo từng khoản</button>
        <button class="sidebar-button" onclick="selectMenu('danhSachDotThu')">Xem danh sách đợt thu</button>
        <button class="sidebar-button" onclick="selectMenu('thongKe')">Thống kê</button>
    </div>
    <!-- Các nút chỉ dành cho ADMIN -->
    <div sec:authorize="hasRole('ROLE_ADMIN')">
        <a th:href="@{/hokhau/list}" class="sidebar-button" onclick="selectMenu('hoKhau')">Quản lý hộ khẩu</a>
        <a th:href="@{/nhankhau/list}" class="sidebar-button" onclick="selectMenu('nhanKhau')">Quản lý nhân khẩu</a>
        <a th:href="@{/biendong/list}" class="sidebar-button" onclick="selectMenu('bienDong')">Quản lý biến động nhân khẩu</a>
        <a th:href="@{/users/list}" class="sidebar-button" onclick="selectMenu('user')">Quản lý người dùng</a>
    </div>
</aside>

<main>
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Danh sách hộ khẩu</h2>
            <!-- Nút mở modal -->
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal">+ Thêm Hộ khẩu</button>

            <!-- Modal thêm khoản thu -->
            <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">

                        <form th:action="@{/hokhau/save}" method="post" th:object="${newHoKhau}">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title" id="addModalLabel">Thêm hộ khẩu mới</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>

                            <div class="modal-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Số hộ khẩu</label>
                                        <input type="text" th:field="*{sohokhau}" class="form-control" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Số hộ khẩu</label>
                                        <input type="text" th:field="*{sohokhau}" class="form-control" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">ID chủ hộ</label>
                                        <input type="text" th:field="*{chuho_id}" class="form-control" required>
                                    </div>
                                </div>
                            </div>

                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">Lưu</button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                            </div>
                        </form>

                    </div>
                </div>
            </div>

        </div>
        </div>

        <table class="table table-bordered table-striped align-middle text-center">
            <thead class="table-primary">
            <tr>
                <th>Số hộ khẩu</th>
                <th>Chủ hộ</th>
                <th>Địa chỉ</th>
                <th>Ngày lập</th>
                <th>Hành động</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="hk : ${list}">
                <td th:text="${hk.sohokhau}"></td>
                <td th:text="${hk.chuho.hoten}"></td>
                <td th:text="${hk.sonha + ', ' + hk.duong + ', ' + hk.phuong + ', ' + hk.quan}"></td>
                <td th:text="${#dates.format(hk.ngaylamhokhau, 'dd/MM/yyyy')}"></td>
                <td class="action-buttons">
                    <a th:href="@{/hokhau/edit/{id}(id=${hk.sohokhau})}" class="btn btn-warning btn-sm">Sửa</a>
                    <form th:action="@{/hokhau/delete/{id}(id=${hk.sohokhau})}" method="post" style="display:inline;" onsubmit="return confirm('Bạn có chắc muốn xóa hộ khẩu này?');">
                        <input type="hidden" name="_method" value="delete" />
                        <button type="submit" class="btn btn-danger btn-sm">Xoá</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</main>

<footer>
    <p>&copy; 2025 Bluemoon Apartment Management. Thiết kế bởi Nhóm 20 KTPM-HUST.</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>